# This file contains the auditctl rules that are loaded
# whenever the audit daemon is started via the initscripts.
# The rules are simply the parameters that would be passed
# to auditctl.
#
# This file contains the audit configuration intended to
# meet the NISPOM Chapter 8 rules.
#
# For RHEL 5.2 - 5.5  64-bit systems
#
# This file should be saved as /etc/audit/audit.rules.
#
# For audit 1.6.5 and higher
#

# First rule - delete all existing rules
-D

# Increase the buffers to survive stress events.
# Make this bigger for busy systems
-b 10240

## Set failure mode to panic
-f 2

# Feel free to add below this line. See auditctl man page

## Audit 1, 1(a) Enough information to determine the date and time of
## action (e.g., common network time), the system locale of the action,
## the system entity that initiated or completed the action, the resources
## involved, and the action involved.

## Things that could affect time
-a exit,always -F arch=x86_64 -S adjtimex -S clock_settime -S settimeofday -k TIME_CHANGE
-w /etc/localtime -p wa -k TIME_CHANGE

## Things that could affect system locale
-a exit,always -F arch=x86_64 -S sethostname -k SYS_LOCALE
-a exit,always -F arch=x86_64 -S setdomainname -k SYS_LOCALE
-w /etc/issue -p wa -k SYS_LOCALE
-w /etc/motd -p wa -k SYS_LOCALE
-w /etc/issue.net -p wa -k SYS_LOCALE
-w /etc/hosts -p wa -k SYS_LOCALE
-w /etc/sysconfig/network -p wa -k SYS_LOCALE

## Key set to "SEC-REL-OBJ" for easy parsing with ausearch --key SEC-REL-OBJ.
-w /etc/passwd -p rwa -k SEC-REL-OBJ
-w /etc/shadow -p rwa -k SEC-REL-OBJ
-w /etc/security/opasswd -p wa -k SEC-REL-OBJ
-w /etc/gshadow -p wa -k SEC-REL-OBJ
-w /bin -p wa -k SEC-REL-OBJ
-w /sbin -p wa -k SEC-REL-OBJ
-w /usr/bin -p wa -k SEC-REL-OBJ
-w /usr/sbin -p wa -k SEC-REL-OBJ
-w /etc/login.defs -p wa -k SEC-REL-OBJ
-w /etc/selinux/ -p wa -k SEC-REL-OBJ
-w /etc/sudoers -p rwa -k SEC-REL-OBJ
-w /etc/sysctl.conf -p wa -k SEC-REL-OBJ
-w /etc/modprobe.d/ -p wa -k SEC-REL-OBJ
-w /etc/pam.d/ -p wa -k SEC-REL-OBJ
-w /etc/audit/auditd.conf -p wa -k SEC-REL-OBJ
-w /etc/audit/audit.rules -p wa -k SEC-REL-OBJ
-w /etc/puppet -p wa -k SEC-REL-OBJ
-w /var/log/faillog -p wa -k SEC-REL-OBJ
-w /var/log/lastlog -p wa -k SEC-REL-OBJ
-a exit,always -F dir=/var/ -F perm=rwa -F success=0 -k SEC-REL-OBJ
-a exit,always -F dir=/lib/ -F perm=rwa -F success=0 -k SEC-REL-OBJ
-a exit,always -F dir=/lib64/ -F perm=rwa -F success=0 -k SEC-REL-OBJ
-a exit,always -F dir=/usr/lib/ -F perm=rwa -F success=0 -k SEC-REL-OBJ
-a exit,always -F dir=/usr/lib64/ -F perm=rwa -F success=0 -k SEC-REL-OBJ
## Suppress all VMware Tools messages
#-a exit,never -F arch=x86_64 -S fork -F success=0 -F path=/usr/lib/vmware-tools -F subj_type=initrc_t -F exit=4294967294

## AIDE
-w /etc/aide.conf -p wa -k AIDE
-w /var/lib/aide/aide.db.gz -k AIDE
-w /var/lib/aide/aide.db.new.gz -k AIDE

## Cron 
-w /etc/cron.allow -p wa -k CRON
-w /etc/cron.deny -p wa -k CRON
-w /etc/cron.d/ -p wa -k CRON
-w /etc/cron.daily/ -p wa -k CRON
-w /etc/cron.hourly/ -p wa -k CRON
-w /etc/cron.monthly/ -p wa -k CRON
-w /etc/cron.weekly/ -p wa -k CRON
-w /etc/crontab -p wa -k CRON
-w /var/spool/cron/ -k CRON

## Account Termination, Disabling, Modifications, and Creation
-w /usr/bin/passwd -p x -k SEC-REL-OBJ
-w /usr/sbin/userdel -p x -k SEC-REL-OBJ
-w /usr/sbin/groupdel -p x -k SEC-REL-OBJ
-w /usr/sbin/usermod -p x -k SEC-REL-OBJ
-w /usr/sbin/groupmod -p x -k SEC-REL-OBJ
-w /usr/sbin/useradd -p x -k SEC-REL-OBJ
-w /usr/sbin/groupadd -p x -k SEC-REL-OBJ


## Watch for module insertion
-w /sbin/insmod -p x -k SEC-REL-OBJ
-w /sbin/rmmod -p x -k SEC-REL-OBJ
-w /sbin/modprobe -p x -k SEC-REL-OBJ
-a always,exit -F arch=x86_64 -S init_module -S delete_module -k SEC-REL-OBJ

-a exit,always -F arch=x86_64 -S sched_setscheduler -S sched_setparam -k SEC-REL-OBJ
-a exit,always -F arch=x86_64 -S acct -k SEC-ACCT
-a exit,always -F arch=x86_64 -S reboot -k SEC-REBOOT
-a exit,always -F arch=x86_64 -S chmod -S fchmod -S fchmodat -S chown -S fchown -S removexattr -S lremovexattr -S fremovexattr -k SEC-REL-OBJ
-a exit,always -F arch=x86_64 -S lchown -S rmdir -S unlink -S fchownat -S setxattr -S lsetxattr -S fsetxattr -k SEC-REL-OBJ

## Audit failed attempts to access files and programs
-a exit,always -F arch=x86_64 -S creat -F success=0 
-a exit,always -F arch=x86_64 -S open -F success=0
-a exit,always -F arch=x86_64 -S openat -F success=0
-a exit,always -F arch=x86_64 -S truncate -F success=0
-a exit,always -F arch=x86_64 -S ftruncate -F success=0


## SOPHOS-AV
#-w /opt/sophos-av -p wa -k SEC-REL-OBJ
#-w /opt/sophos-av/lib/sav/ -p wa -k SEC-REL-OBJ
#-w /opt/sophos-av/bin/savscan -p wa -k SEC-REL-OBJ
#-w /opt/sophos-av/bin/savconfig -p wa -k SEC-REL-OBJ
#-w /opt/sophos-av/bin/savdstatus -p wa -k SEC-REL-OBJ
#-w /opt/sophos-av/bin/savdctl -p wa -k SEC-REL-OBJ
#-w /opt/sophos-av/bin/savupdate -p wa -k SEC-REL-OBJ
#-w /opt/sophos-av/bin/savsetup -p wa -k SEC-REL-OBJ
#-w /etc/init.d/sav-protect -p wa -k SEC-REL-OBJ
#-w /etc/init.d/sav-rms -p wa -k SEC-REL-OBJ
#-w /etc/init.d/sav-web -p wa -k SEC-REL-OBJ

## ClamAV
#-w /usr/local/share/clamav/daily.cvd -p wa -k SEC-REL-OBJ
#-w /usr/local/share/clamav/main.cvd -p wa -k SEC-REL-OBJ
#-w /usr/local/bin/clamscan -p wa -k SEC-REL-OBJ
#-w /usr/local/bin/clamdscan -p wa -k SEC-REL-OBJ
#-w /usr/local/bin/clamav_config -p wa -k SEC-REL-OBJ
#-w /usr/local/bin/clamconf -p wa -k SEC-REL-OBJ
-w /etc/freshclam.conf -p wa -k SEC-REL-OBJ
-w /etc/logrotate.d/freshclam -p wa -k SEC-REL-OBJ
-w /usr/bin/clamscan -p wa -k SEC-REL-OBJ
-w /usr/bin/clamav-config -p wa -k SEC-REL-OBJ
-w /usr/bin/clambc -p wa -k SEC-REL-OBJ
-w /usr/bin/freshclam -p wa -k SEC-REL-OBJ
-w /var/clamav/daily.cvd -p wa -k SEC-REL-OBJ
-w /var/clamav/main.cvd -p wa -k SEC-REL-OBJ
